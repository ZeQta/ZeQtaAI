<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ZeQta Copilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Basic Reset & Global Styles -->
  <style>
    * {
      margin: 0; 
      padding: 0; 
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      background-color: #101828; /* Dark background */
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      overflow: hidden; /* Avoid scroll bars on body */
    }
    body {
      display: flex;
      flex-direction: column;
    }

    /* Top bar */
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      flex-shrink: 0;
    }
    .icon-btn {
      width: 28px;
      height: 28px;
      cursor: pointer;
    }
    .menu-icon {
      background: url('data:image/svg+xml;utf8,<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><g fill="%23FFFFFF"><rect x="3" y="5" width="18" height="2"/><rect x="3" y="11" width="18" height="2"/><rect x="3" y="17" width="18" height="2"/></g></svg>') no-repeat center;
      background-size: contain;
    }
    .share-icon {
      background: url('data:image/svg+xml;utf8,<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg"><g fill="%23FFFFFF"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></g></svg>') no-repeat center;
      background-size: contain;
    }

    /* Main chat area */
    .chat-area {
      display: flex;
      flex-direction: column;
      flex: 1; /* Fill remaining space */
      overflow: hidden;
      padding: 0 16px 16px; /* side + bottom padding */
    }
    .messages {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px; /* small spacing on the right to avoid scrollbar overlap */
      margin-bottom: 12px; 
      scrollbar-width: thin; 
      scrollbar-color: #374151 #101828;
    }
    .messages::-webkit-scrollbar {
      width: 6px;
    }
    .messages::-webkit-scrollbar-track {
      background: #101828;
    }
    .messages::-webkit-scrollbar-thumb {
      background-color: #374151;
      border-radius: 10px;
    }

    /* Chat bubbles */
    .bubble {
      margin-bottom: 12px;
      padding: 12px 16px;
      border-radius: 12px;
      max-width: 75%;
      line-height: 1.4;
      word-wrap: break-word;
      opacity: 0;           /* Start hidden for fade-in animation */
      transform: translateY(5px);
      animation: fadeInUp 0.3s forwards; 
    }
    .bubble.user {
      background-color: #2563eb;
      margin-left: auto;
      color: #fff;
      text-align: right;
    }
    .bubble.bot {
      background-color: #374151;
      margin-right: auto;
    }
    /* Fade-in + slight upward movement */
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Bottom bar: model selector + input area */
    .bottom-controls {
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .model-select {
      background: #1d2939;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px;
      font-size: 0.9rem;
    }
    .input-row {
      display: flex;
      background-color: #1d2939;
      border-radius: 9999px;
      align-items: center;
      padding: 8px 12px;
    }
    .input-row input {
      flex: 1;
      border: none;
      background: transparent;
      color: #fff;
      font-size: 1rem;
      outline: none;
      margin-right: 8px;
    }
    .send-btn {
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      font-size: 1.3rem;
    }
  </style>

  <!-- Puter.js -->
  <script src="https://js.puter.com/v2/"></script>
</head>
<body>
  <!-- Top Bar -->
  <div class="topbar">
    <div class="icon-btn menu-icon"></div>
    <div class="icon-btn share-icon"></div>
  </div>

  <!-- Chat Area -->
  <div class="chat-area">
    <div class="messages" id="messagesContainer">
      <!-- We'll insert chat bubbles dynamically here -->
    </div>

    <!-- Bottom Controls: Model Selector + Input Row -->
    <div class="bottom-controls">
      <select id="modelSelect" class="model-select">
        <option value="gpt-4o-mini">GPT-4o Mini</option>
        <option value="claude-3-5-sonnet">Claude 3.5 Sonnet</option>
        <option value="claude-3-7-sonnet">Claude 3.7 Sonnet</option>
        <option value="llama">Llama</option>
        <option value="deepseek-chat">DeepSeek Chat</option>
        <option value="deepseek-reasoner">DeepSeek Reasoner</option>
        <option value="o3-mini">o3-mini</option>
        <option value="gemini-2-0-flash">Gemini 2.0 Flash</option>
        <option value="dall-e-3">DALL·E 3 (Image)</option>
      </select>

      <div class="input-row">
        <input 
          type="text" 
          id="userInput" 
          placeholder="Message Copilot..." 
          autocomplete="off"
        />
        <button id="sendBtn" class="send-btn">➤</button>
      </div>
    </div>
  </div>

  <script>
    const messagesContainer = document.getElementById('messagesContainer');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const modelSelect = document.getElementById('modelSelect');

    // Start with a greeting from the bot
    let conversation = [];
    addBubble('bot', "Hi, I am ZeQta Copilot. How can I help you today?");

    // Send message on button click or Enter
    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });

    function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      
      // Show user message
      addBubble('user', text);
      conversation.push({ role: 'user', content: text });
      userInput.value = '';

      // Temporary "Thinking..." bubble
      const tempMsg = addBubble('bot', 'Thinking...');

      // Determine model
      const selectedModel = modelSelect.value;

      if (selectedModel === 'dall-e-3') {
        // Image generation
        puter.ai.image(text, { model: selectedModel })
          .then(imageUrl => {
            // Remove "Thinking..." bubble
            messagesContainer.removeChild(tempMsg);
            // Insert an image bubble
            const imgBubble = document.createElement('div');
            imgBubble.classList.add('bubble', 'bot');
            
            const imgElem = document.createElement('img');
            imgElem.src = imageUrl;
            imgElem.alt = "Generated Image";
            imgElem.style.maxWidth = '100%';
            imgElem.style.borderRadius = '8px';

            imgBubble.appendChild(imgElem);
            messagesContainer.appendChild(imgBubble);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            conversation.push({ role: 'bot', content: '[Image generated]' });
          })
          .catch(err => {
            messagesContainer.removeChild(tempMsg);
            addBubble('bot', 'Error: ' + err.message);
          });
      } else {
        // Text generation
        puter.ai.chat(text, { model: selectedModel })
          .then(response => {
            messagesContainer.removeChild(tempMsg);
            const botResponse = response.message.content;
            addBubble('bot', botResponse);
            conversation.push({ role: 'bot', content: botResponse });
          })
          .catch(err => {
            messagesContainer.removeChild(tempMsg);
            addBubble('bot', 'Error: ' + err.message);
          });
      }
    }

    // Helper to add a bubble to the chat
    function addBubble(sender, text) {
      const bubble = document.createElement('div');
      bubble.classList.add('bubble', sender);
      // If text is multiline, preserve line breaks
      bubble.textContent = text;
      messagesContainer.appendChild(bubble);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      return bubble;
    }
  </script>
</body>
</html>
